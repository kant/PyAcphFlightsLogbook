<!DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"> -->

	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">

	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
	<!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css"> -->

	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment-with-locales.js" integrity="sha512-xQokr7XOzq2ogYezmdoq13t2xcYBoKM0aZJjF91NvQX2D114fVe5yghALtQ25S+iADg4Cqzyj0P7MluW2TrgHw==" crossorigin="anonymous"></script>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Planche des vols</title>
</head>
<body>
	<script>
	var airfield = "LFHA";
	var show_glider_only = true;	

	var logBook_date = new Date().toJSON().slice(0,10);
	console.log('date : '+logBook_date); 

	function testReadJsonFile() {
		// $.getJSON("result.json", function(data){
		$.getJSON("../db/acph-logbook-2020-08-09.json", function(data){
			// console.log(data[logBook_date]); 
			console.log(data); 
			var keys = Object.keys(data);
			console.log('keys of the json object are: '+keys); 
			// console.log('json object for '+logBook_date+' is: '+data['2020-08-07']); 
		}).fail(function(){
			console.log("An error has occurred.");
		});
	}	
	
	function updateTable() {
		$('#table_id').DataTable( {
			// "ajax": {
			// 	"url": "result.json",
			// 	"dataSrc": logBook_date
			// },
			"ajax":  "../db/acph-logbook-2020-08-10.json",
		
			"columns": [
				{ "data": "aircraft_type" },
				{ "data": "registration" },
				{ "data": "aircraft_model" },
				{ "data": "takeoff_airport" },
				{ "data": "takeoff_time" },
				{ "data": "landing_airport" },
				{ "data": "landing_time"},
				{ "data": "flight_duration" },
				{ "data": "launch_type" },
				{ "data": "status" },
				{ "data": "receivers" },

			],
			"columnDefs": [ 
				{ "render": function ( data, type, row ) {
						return ( data === '' ? row['aircraft_id'] : data ) ;
				 }, 
				 "targets": 1
				},
				{ "render": function ( data, type, row ) {
						var m = moment.utc(data).local();
						if (m.second()>30) m.add('minute',1);
						// return data.slice(11,19) + ' (' + m.format('HH:mm') + ')';
						return ( m.format('HH:mm') != 'Invalid date' ? m.format('HH:mm') : 'Invalid date (' + data + ')') ;
				 }, 
				 "targets": 4
				},
				{ "render": function ( data, type, row ) {
						var m = moment.utc(data).local();
						if (m.second()>30) m.add('minute',1);
						// return data.slice(11,19) + ' (' + m.format('HH:mm') + ')';
						return ( m.format('HH:mm') != 'Invalid date' ? m.format('HH:mm') : 'Invalid date (' + data + ')') ;
				 }, 
				 "targets": 6
				},
				{ "render": function ( data, type, row ) {
						var m = moment.duration(data);
						if (m.seconds() > 30) { m.add(60-m.seconds(),'s') }
						// return data + ' (' + m.hours() + 'h' + m.minutes() + ')';
						// return data + ' (' + m.toISOString() + ')';
						return m.hours() + 'h' + ( m.minutes()<10 ? '0'+m.minutes(): m.minutes()) ;
				 }, 
				 "targets": 7
				},
			],
			"order": [[ 4, "asc" ]]
		} );
	}

	$(document).ready(function() {
		$('#gliderOnly').click(function () {
			console.log('glider check box value is '+ $(this).is(':checked'));
			if ( $(this).is(':checked'))
				$('#table_id').DataTable().search( 'glider' ).draw();
			else
				$('#table_id').DataTable().search( '' ).draw();
		});	

		testReadJsonFile();
		updateTable();

		var table = $('#table_id').DataTable();
		table.search( 'glider' ).draw();
	});
	</script>

	<div class ="container">
		<br/>
		<div class="row">
			<div class="col-md-2">
			<img src="/wp-content/uploads/2016/03/logo-acph.jpg" width="150">
			</div>
			<div class="col-md-10 align-self-center">
				<h2>Planche de vols</h5>
			</div>
		</div>
		<br/>

		<div class="card" >
			<div class="card-body">
				<div class="form-inline">
					<label style="padding-right:10px">Date</label>
					<input type="date" id='dateInput' class="form-control">
				</div>

				<div class="form-check form-check-inline">
					<label style="padding-right:10px" class="form-check-label">Voir uniquement les planeurs</label>
					<input class="form-check-input" type="checkbox" id='gliderOnly' value="1" checked>
				</div>
			</div>
			<div class="card-body">
				<div id="flights-log" class="table-responsive">
					<table id="table_id" class="display compact" data-page-length='25'>
					<!-- <table id="table_id" class="table table-striped table-bordered compact" data-page-length='25'> -->
						<thead>
							<tr>
								<th rowspan="2">Type</th>
								<th rowspan="2">Imat</th>
								<th rowspan="2">Modèle</th>
								<th colspan="2">Takeoff</th>
								<th colspan="2">Landing</th>
								<th rowspan="2">Flight duration</th>
								<th rowspan="2">Launch</th>
								<th rowspan="2">Status</th>
								<th rowspan="2">Receivers</th>
							</tr>
							<tr>
								<th>Airport</th>
								<th>Time</th>
								<th>Airport</th>
								<th>Time</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
			<div class="card-footer text-muted">
				Version expérimentale - copyright ACPH - 2020.
			</div>
		</div>
	</div>

</body>
</html>
